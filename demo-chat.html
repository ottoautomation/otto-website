<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OTTO Demo Chat</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: #0a0a0a;
            height: 100vh;
            overflow: hidden;
            margin: 0;
        }

        #mainContainer {
            display: flex;
            height: 100vh;
            max-width: 100%;
        }

        /* Sidebar with sample questions */
        #questionsSidebar {
            width: 280px;
            background: #111;
            border-right: 1px solid #333;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        #sidebarHeader {
            padding: 16px;
            border-bottom: 1px solid #333;
            background: #0a0a0a;
        }

        #sidebarHeader h3 {
            color: var(--brand-color, #3AB573);
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 4px;
        }

        #sidebarHeader p {
            color: #888;
            font-size: 12px;
        }

        #questionsList {
            flex: 1;
            overflow-y: auto;
            padding: 12px;
        }

        .sample-question {
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 8px;
            color: #ccc;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s;
            line-height: 1.4;
        }

        .sample-question:hover {
            background: #222;
            border-color: var(--brand-color, #3AB573);
            color: #fff;
        }

        /* Chat container */
        #chatContainer {
            flex: 1;
            display: flex;
            flex-direction: column;
            height: 100vh;
            background: #ffffff;
        }

        #chatHeader {
            padding: 16px 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            color: #fff;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        #chatLogo {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 15px;
            overflow: hidden;
        }

        #chatLogo img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        #chatHeaderText {
            flex: 1;
        }

        #businessName {
            font-weight: 600;
            font-size: 15px;
        }

        #onlineStatus {
            font-size: 12px;
            opacity: 0.8;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        #onlineStatus::before {
            content: '';
            width: 8px;
            height: 8px;
            background: #4ade80;
            border-radius: 50%;
        }

        #chatMessages {
            flex: 1;
            overflow-y: auto;
            padding: 24px 20px;
            display: flex;
            flex-direction: column;
            gap: 16px;
            background: #f9fafb;
        }

        .message {
            max-width: 75%;
            padding: 12px 16px;
            border-radius: 18px;
            font-size: 14px;
            line-height: 1.5;
            animation: slideIn 0.3s ease;
            word-wrap: break-word;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .message.otto {
            background: #ffffff;
            color: #1f2937;
            align-self: flex-start;
            border: 1px solid #e5e7eb;
            box-shadow: 0 1px 3px rgba(0,0,0,0.08);
        }

        .message.user {
            background: var(--brand-color, #3AB573);
            color: #ffffff;
            align-self: flex-end;
            border-radius: 18px 18px 4px 18px;
        }

        #chatInput {
            padding: 16px 20px;
            background: #ffffff;
            border-top: 1px solid #e5e7eb;
        }

        #inputContainer {
            display: flex;
            gap: 10px;
            align-items: center;
            background: #f9fafb;
            padding: 8px 12px;
            border-radius: 24px;
            border: 1.5px solid #e5e7eb;
            transition: all 0.2s;
        }

        #inputContainer:focus-within {
            border-color: var(--brand-color, #3AB573);
            background: #ffffff;
            box-shadow: 0 0 0 3px rgba(58, 181, 115, 0.1);
        }

        #messageInput {
            flex: 1;
            background: transparent;
            border: none;
            color: #1f2937;
            font-size: 14px;
            outline: none;
            padding: 8px 4px;
        }

        #messageInput::placeholder {
            color: #9ca3af;
        }

        #sendButton {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-weight: 700;
            font-size: 16px;
            transition: all 0.2s;
        }

        #sendButton:hover {
            transform: scale(1.05);
        }

        .typing-indicator {
            display: flex;
            gap: 4px;
            padding: 12px 16px;
            background: #ffffff;
            border-radius: 18px;
            border: 1px solid #e5e7eb;
            align-self: flex-start;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #9ca3af;
            animation: typing 1.4s infinite;
        }

        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }

        @keyframes typing {
            0%, 60%, 100% { opacity: 0.3; transform: translateY(0); }
            30% { opacity: 1; transform: translateY(-4px); }
        }

        #ctaBanner {
            display: none;
            margin-top: 12px;
            padding: 16px;
            background: linear-gradient(135deg, var(--brand-color, #3AB573) 0%, #2d9c5f 100%);
            border-radius: 12px;
            text-align: center;
        }

        #ctaBanner p {
            color: #fff;
            font-weight: 600;
            font-size: 14px;
            margin: 0 0 10px 0;
        }

        #ctaBanner button {
            padding: 10px 20px;
            background: #fff;
            color: var(--brand-color, #3AB573);
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
        }

        @media (max-width: 600px) {
            #mainContainer { flex-direction: column; }
            #questionsSidebar {
                width: 100%;
                max-height: 140px;
                border-right: none;
                border-bottom: 1px solid #333;
            }
            #questionsList {
                display: flex;
                overflow-x: auto;
                padding: 8px;
                gap: 8px;
            }
            .sample-question {
                flex-shrink: 0;
                width: 180px;
                margin-bottom: 0;
            }
        }
    </style>
</head>
<body>
    <div id="mainContainer">
        <div id="questionsSidebar">
            <div id="sidebarHeader">
                <h3>Try These Questions</h3>
                <p>Click to copy, then send!</p>
            </div>
            <div id="questionsList"></div>
        </div>

        <div id="chatContainer">
            <div id="chatHeader">
                <div id="chatLogo"></div>
                <div id="chatHeaderText">
                    <div id="businessName"></div>
                    <div id="onlineStatus">Online</div>
                </div>
            </div>

            <div id="chatMessages"></div>

            <div id="chatInput">
                <div id="inputContainer">
                    <input type="text" id="messageInput" placeholder="Type your message...">
                    <button id="sendButton">→</button>
                </div>
                <div id="ctaBanner">
                    <p>Like what you see?</p>
                    <button onclick="window.location.href='pricing.html'">Get OTTO For My Business →</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let config = {};
        let messageCount = 0;

        const savedConfig = localStorage.getItem('ottoDemoConfig');
        if (savedConfig) {
            config = JSON.parse(savedConfig);
            initializeChat();
        } else {
            document.body.innerHTML = '<div style="padding: 40px; text-align: center; color: #999;">Please configure your demo first</div>';
        }

        function initializeChat() {
            document.documentElement.style.setProperty('--brand-color', config.brandColor);
            document.getElementById('chatHeader').style.background = config.brandColor;

            const logoEl = document.getElementById('chatLogo');
            if (config.logo) {
                logoEl.innerHTML = `<img src="${config.logo}" alt="Logo">`;
            } else {
                logoEl.style.background = '#000';
                logoEl.style.color = config.brandColor;
                logoEl.textContent = config.businessName.substring(0, 2).toUpperCase();
            }

            document.getElementById('businessName').textContent = config.businessName;
            document.getElementById('sendButton').style.background = config.brandColor;
            document.getElementById('sendButton').style.color = '#000';

            populateSampleQuestions();

            setTimeout(() => {
                sendOttoMessage(`Hi! I'm the AI assistant for ${config.businessName}. How can I help you today?`);
            }, 500);

            document.getElementById('messageInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') sendUserMessage();
            });
            document.getElementById('sendButton').addEventListener('click', sendUserMessage);
        }

        function populateSampleQuestions() {
            const questionsList = document.getElementById('questionsList');

            if (config.faqs && config.faqs.length > 0) {
                config.faqs.forEach(faq => {
                    const questionDiv = document.createElement('div');
                    questionDiv.className = 'sample-question';
                    questionDiv.textContent = faq.question;
                    questionDiv.onclick = () => {
                        document.getElementById('messageInput').value = faq.question;
                        document.getElementById('messageInput').focus();
                    };
                    questionsList.appendChild(questionDiv);
                });
            }

            // Add generic questions
            const extras = ["Can I book an appointment?", "How can I contact you?"];
            extras.forEach(q => {
                const div = document.createElement('div');
                div.className = 'sample-question';
                div.textContent = q;
                div.onclick = () => {
                    document.getElementById('messageInput').value = q;
                    document.getElementById('messageInput').focus();
                };
                questionsList.appendChild(div);
            });
        }

        function sendOttoMessage(message, showTyping = true) {
            const container = document.getElementById('chatMessages');

            if (showTyping) {
                const typingDiv = document.createElement('div');
                typingDiv.className = 'typing-indicator';
                typingDiv.innerHTML = '<div class="typing-dot"></div><div class="typing-dot"></div><div class="typing-dot"></div>';
                container.appendChild(typingDiv);
                container.scrollTop = container.scrollHeight;

                setTimeout(() => {
                    typingDiv.remove();
                    addMessage(message, 'otto');
                }, 1000);
            } else {
                addMessage(message, 'otto');
            }
        }

        function addMessage(message, sender) {
            const container = document.getElementById('chatMessages');
            const div = document.createElement('div');
            div.className = `message ${sender}`;
            div.textContent = message;
            container.appendChild(div);
            container.scrollTop = container.scrollHeight;

            if (sender === 'user') {
                messageCount++;
                if (messageCount >= 3) {
                    setTimeout(() => {
                        document.getElementById('ctaBanner').style.display = 'block';
                    }, 2000);
                }
            }
        }

        function findBestFAQMatch(userMessage) {
            if (!config.faqs || config.faqs.length === 0) return null;

            const lowerMsg = userMessage.toLowerCase();
            let bestMatch = null;
            let bestScore = 0;

            config.faqs.forEach(faq => {
                const questionLower = faq.question.toLowerCase();
                let score = 0;

                const faqKeywords = questionLower.replace(/[?,.!]/g, '').split(' ').filter(w => w.length > 3);
                faqKeywords.forEach(kw => { if (lowerMsg.includes(kw)) score += 2; });

                if (lowerMsg.includes(questionLower.replace(/[?,.!]/g, ''))) score += 10;

                const patterns = {
                    'hours': ['hours', 'open', 'close', 'when', 'time'],
                    'price': ['price', 'cost', 'charge', 'fee', 'much'],
                    'appointment': ['book', 'appointment', 'schedule', 'reserve'],
                    'insurance': ['insurance', 'accept', 'coverage'],
                    'service': ['service', 'offer', 'provide'],
                    'estimate': ['estimate', 'quote', 'free']
                };

                for (const [cat, kws] of Object.entries(patterns)) {
                    if (kws.some(k => questionLower.includes(k)) && kws.some(k => lowerMsg.includes(k))) score += 5;
                }

                if (score > bestScore) { bestScore = score; bestMatch = faq; }
            });

            return bestScore >= 3 ? bestMatch : null;
        }

        function sendUserMessage() {
            const input = document.getElementById('messageInput');
            const message = input.value.trim();
            if (!message) return;

            addMessage(message, 'user');
            input.value = '';

            setTimeout(() => {
                let response = '';
                const lowerMsg = message.toLowerCase();
                const faqMatch = findBestFAQMatch(message);

                if (faqMatch) {
                    response = faqMatch.answer;
                } else if (lowerMsg.match(/\b(book|appointment|schedule|reserve)\b/)) {
                    response = `I'd be happy to help you schedule! What day and time works best for you?`;
                } else if (lowerMsg.match(/\b(hours|open|close|when)\b/)) {
                    response = config.businessHours ? `Our hours are ${config.businessHours}.` : `We're open during regular business hours. Feel free to contact us!`;
                } else if (lowerMsg.match(/\b(contact|call|phone|email)\b/)) {
                    response = `You can reach us through our website or give us a call during business hours!`;
                } else if (lowerMsg.match(/\b(price|cost|how much|rate|fee)\b/)) {
                    response = `Pricing varies based on your needs. Would you like a personalized quote?`;
                } else if (lowerMsg.match(/\b(thank|thanks)\b/)) {
                    response = `You're welcome! Anything else I can help with?`;
                } else if (lowerMsg.match(/^(hi|hello|hey)\.?$/i)) {
                    response = `Hello! How can I help you today?`;
                } else if (lowerMsg.match(/\b(bye|goodbye)\b/)) {
                    response = `Thanks for chatting! Have a great day!`;
                } else if (lowerMsg.includes('?')) {
                    response = `Great question! For the most accurate answer, I'd recommend reaching out to our team directly. Is there anything else I can help with?`;
                } else {
                    response = `Thanks for reaching out! What would you like to know about ${config.businessName}?`;
                }

                sendOttoMessage(response);
            }, 800);
        }
    </script>
</body>
</html>
